import"./DsnmJJEf.js";import{ad as J,w as q,a as W,f as V,c as Q,r as Z,t as z,s as ee,d as te,p as re,q as ie,h as oe,ae as ne,b as ae,af as se,y as ce}from"./Ce8YuaDY.js";import{a as D,r as fe,i as ue,s as le,f as de}from"./BX_KVGA7.js";import{i as me,b as Ee}from"./CBYY5G0K.js";import{s as K,a as y}from"./BA8C_d9j.js";import{n as Te}from"./gf28JVaL.js";import"./DTIIxCa-.js";const k=`#version 300 es
in vec2 a_position;


void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
}`;var ge=V('<div class="pointer-events-none absolute bottom-2 z-10 w-full rounded-lg bg-red-500/80 p-1 text-sm text-white shadow-lg"> </div>');function he(F){const[X,w]=K(),A=()=>y(D,"$isErrorMessage",X);var l=J(),m=q(l);{var a=e=>{var o=ge(),E=Q(o,!0);Z(o),z(()=>ee(E,A())),W(e,o)};me(m,e=>{A()&&e(a)})}W(F,l),w()}var _e=()=>{Te("next")},Re=V("<canvas></canvas> <!>",1);function Se(F,X){re(X,!0);const[w,A]=K(),l=()=>y(de,"$fs",w),m=()=>y(ue,"$isFullCanvas",w);let a=null,e=null,o=null,E=null,U=null,H=null,v=null,C=null,T=null,R=null,g=null,h=null,d=null;const x=1;let u=0,I=0,M=0;const L=(t,i,n)=>{const r=t.createShader(i);if(!r)return console.error("Failed to create shader"),null;let s=n;if(i===t.FRAGMENT_SHADER){const P=`#version 300 es
                    #ifdef GL_FRAGMENT_PRECISION_HIGH
                    precision highp float;
                    #else
                    precision mediump float;
                    #endif

                    `;if(!n.includes("precision"))if(n.includes("#version")){const b=n.match(/#version\s+\d+.*?\n/);if(b){const p=b[0];s=n.replace(p,p+P)}}else s=P+n}return t.shaderSource(r,s),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?(D.set(null),r):(D.set(t.getShaderInfoLog(r)),console.error("Shader compilation error:",t.getShaderInfoLog(r)),t.deleteShader(r),null)},$=(t,i,n)=>{const r=t.createProgram();return t.attachShader(r,i),t.attachShader(r,n),t.bindAttribLocation(r,0,"a_position"),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)?r:(console.error("Program linking error:",t.getProgramInfoLog(r)),t.deleteProgram(r),null)};ie(()=>{if(!a){console.error("Canvas element not found");return}e=a.getContext("webgl2")||a.getContext("webgl");const t=window.innerWidth,i=window.innerHeight;if(!e){console.error("WebGL context not available");return}if(!l()){D.set("Fragment shader code is empty.");return}const n=L(e,e.VERTEX_SHADER,k),r=L(e,e.FRAGMENT_SHADER,l());if(!n||!r){console.error("Failed to create shaders");return}if(o=$(e,n,r),!o){console.error("Failed to create shader program");return}e.useProgram(o);const s=e.getAttribLocation(o,"a_position");E=e.getUniformLocation(o,"time"),v=e.getUniformLocation(o,"resolution"),U=e.getUniformLocation(o,"mouse"),g=e.getUniformLocation(o,"audioTex"),h=e.getUniformLocation(o,"audioBins");const f=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,f);const P=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1];e.bufferData(e.ARRAY_BUFFER,new Float32Array(P),e.STATIC_DRAW),e.enableVertexAttribArray(s),e.bindBuffer(e.ARRAY_BUFFER,f),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),H=e.createTexture(),e.bindTexture(e.TEXTURE_2D,H),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),R=e.createTexture(),e.activeTexture(e.TEXTURE0+x),e.bindTexture(e.TEXTURE_2D,R),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.canvas.width=t,e.canvas.height=i,e.viewport(0,0,t,i),e.useProgram(o),(async()=>{try{const B=await navigator.mediaDevices.getUserMedia({audio:!0});C=new(window.AudioContext||window.webkitAudioContext);const N=C.createMediaStreamSource(B);T=C.createAnalyser(),T.fftSize=1024,u=T.frequencyBinCount,d=new Uint8Array(u),N.connect(T);const G=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext;if(e.activeTexture(e.TEXTURE0+x),e.bindTexture(e.TEXTURE_2D,R),G){const c=e;c.texImage2D(c.TEXTURE_2D,0,c.R8,u,1,0,c.RED,c.UNSIGNED_BYTE,d)}else e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,u,1,0,e.LUMINANCE,e.UNSIGNED_BYTE,d)}catch(B){console.error("Microphone init failed",B)}})();const b=performance.now(),p=()=>{const N=(performance.now()-b)/1e3;if(!e){console.error("WebGL context not available or animation stopped");return}if(e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.useProgram(o),E&&e.uniform1f(E,N),v&&e.uniform2f(v,e.drawingBufferWidth,e.drawingBufferHeight),U&&e.uniform2f(U,I,M),T&&d&&R){T.getByteFrequencyData(d);const G=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext;if(e.activeTexture(e.TEXTURE0+x),e.bindTexture(e.TEXTURE_2D,R),G){const c=e;c.texSubImage2D(c.TEXTURE_2D,0,0,0,u,1,c.RED,c.UNSIGNED_BYTE,d)}else e.texSubImage2D(e.TEXTURE_2D,0,0,0,u,1,e.LUMINANCE,e.UNSIGNED_BYTE,d);g&&e.uniform1i(g,x),h&&e.uniform1f(h,u)}e.drawArrays(e.TRIANGLES,0,6),requestAnimationFrame(p)};p(),S(e,a)}),fe.subscribe(t=>{if(!e||!l())return;const i=L(e,e.VERTEX_SHADER,k),n=L(e,e.FRAGMENT_SHADER,l());if(!i||!n){console.error("Failed to compile shaders on update");return}const r=$(e,i,n);if(!r){console.error("Failed to link program on update");return}o&&e.deleteProgram(o),o=r,e.useProgram(o),E=e.getUniformLocation(o,"time"),v=e.getUniformLocation(o,"resolution"),U=e.getUniformLocation(o,"mouse"),g=e.getUniformLocation(o,"audioTex"),h=e.getUniformLocation(o,"audioBins"),g&&e.uniform1i(g,x),h&&e.uniform1f(h,u);const s=e.getAttribLocation(o,"a_position");s!==-1&&(e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0))});const S=(t,i)=>{const n=Math.max(1,window.devicePixelRatio||1),r=Math.floor(i.clientWidth*n),s=Math.floor(i.clientHeight*n);(i.width!==r||i.height!==s)&&(i.width=r,i.height=s,t.viewport(0,0,r,s))};let O=m();oe(()=>{O!==m()&&(setTimeout(()=>{e&&a&&S(e,a)},50),setTimeout(()=>{e&&a&&S(e,a)},200),O=m())});var Y=Re();ne("resize",se,()=>{e&&a&&e&&a&&S(e,a)});var _=q(Y);_.__click=[_e],_.__mousemove=t=>{if(!e||!a)return;const i=a.getBoundingClientRect(),n=(t.clientX-i.left)*(e.drawingBufferWidth/i.width),r=(t.clientY-i.top)*(e.drawingBufferHeight/i.height),s=e.drawingBufferHeight-r,f=Math.min(e.drawingBufferWidth,e.drawingBufferHeight);I=(n*2-e.drawingBufferWidth)/f,M=(s*2-e.drawingBufferHeight)/f},_.__touchmove=t=>{if(!e||!a||!e||!a)return;const i=a.getBoundingClientRect(),n=(t.clientX-i.left)*(e.drawingBufferWidth/i.width),r=(t.clientY-i.top)*(e.drawingBufferHeight/i.height),s=e.drawingBufferHeight-r,f=Math.min(e.drawingBufferWidth,e.drawingBufferHeight);I=(n*2-e.drawingBufferWidth)/f,M=(s*2-e.drawingBufferHeight)/f},Ee(_,t=>a=t,()=>a);var j=ce(_,2);he(j),z(()=>le(_,1,`z-0 h-full ${m()?"w-full":"w-1/2"}`)),W(F,Y),ae(),A()}te(["click","mousemove","touchmove"]);export{he as E,Se as W};
